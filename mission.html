<!DOCTYPE html>
<html lang="zh">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, user-scalable=no">
<title>THEMACHINE Corp.</title>
<style>
.container { max-width: 640px; margin: 40px auto; padding: 0 20px; }
        :root {
            --bg: #0a0a0a;
            --fg: #c0c0c0;
            --fg-dim: #606060;
            --scanline: rgba(0, 0, 0, 0.5);
        }
        
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        html {
            scroll-behavior: smooth;
        }
        
        body {
            overflow-x: hidden;
            font-family: 'Courier New', Courier, monospace;
            background: var(--bg);
            color: var(--fg);
            line-height: 1.4;
            overflow-x: hidden;
            font-size: 14px;
            
        }
        
        /* CRT effect */
        body::before {
            content: '';
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: repeating-linear-gradient(
                0deg,
                var(--scanline) 0px,
                var(--scanline) 1px,
                transparent 1px,
                transparent 2px
            );
            pointer-events: none;
            z-index: 1000;
        }
        
        /* CRT flicker */
        body::after {
            content: '';
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 255, 0, 0.02);
            pointer-events: none;
            z-index: 999;
            animation: flicker 0.15s infinite;
        }
        
        @keyframes flicker {
            0% { opacity: 0.97; }
            50% { opacity: 1; }
            100% { opacity: 0.98; }
        }
        
        .container {
            max-width: 640px;
            margin: 0 auto;
            padding: 40px 20px;
        }
        
        /* Blinking cursor */
        .cursor {
            display: inline-block;
            width: 10px;
            height: 1.2em;
            background: var(--fg);
            animation: blink 1s step-end infinite;
            vertical-align: text-bottom;
            margin-left: 2px;
        }
        
        @keyframes blink {
            50% { opacity: 0; }
        }
        
        /* Hero */
        .hero {
            min-height: 80vh;
            display: flex;
            flex-direction: column;
            justify-content: center;
        }
        
        .logo {
            color: #FFD700;
            font-size: 2.5rem;
            font-weight: bold;
            margin-bottom: 8px;
            letter-spacing: -2px;
        }
        
        .logo::before {
            content: '> ';
            color: var(--fg-dim);
        }
        
        .subtitle {
            color: var(--fg-dim);
            margin-bottom: 40px;
        }
        
        /* Menu */
        .menu {
            list-style: none;
        }
        
        .menu li {
            margin-bottom: 8px;
        }
        
        .menu a {
            color: var(--fg);
            text-decoration: none;
            display: inline-block;
            transition: all 0.2s;
        }
        
        .menu a::before {
            content: '[ ] ';
            color: var(--fg-dim);
            font-size: 0.8em;
        }
        
        .menu a:hover::before {
            content: '[x] ';
        }
        
        .menu a:hover {
            color: #fff;
        }
        
        /* Sections */
        section {
            padding: 60px 0;
            border-top: 1px dashed var(--fg-dim);
            margin-top: 60px;
        }
        
        section:first-of-type {
            border-top: none;
            margin-top: 0;
        }
        
        h2 {
            font-size: 1rem;
            color: var(--fg-dim);
            margin-bottom: 20px;
        }
        
        h2::before {
            content: '// ';
        }
        
        /* Content */
        p {
            margin-bottom: 16px;
            color: var(--fg-dim);
            max-width: 500px;
        }
        
        strong {
            color: var(--fg);
        }
        
        .highlight {
            background: var(--fg);
            color: var(--bg);
            padding: 0 4px;
        }
        
        /* Grid */
        .grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 16px;
            margin-top: 24px;
        }
        
        .grid-item {
            border: 1px solid var(--fg-dim);
            padding: 16px;
        }
        
        .grid-item h3 {
            font-size: 0.9rem;
            margin-bottom: 8px;
        }
        
        .grid-item p {
            font-size: 0.8rem;
            margin: 0;
        }
        
        /* Links */
        .links {
            display: flex;
            gap: 24px;
            margin-top: 24px;
            flex-wrap: wrap;
        }
        
        .links a {
            color: var(--fg);
            text-decoration: none;
            font-size: 0.9rem;
        }
        
        .links a:hover {
            text-decoration: underline;
        }
        
        /* Footer */
        footer {
            padding: 40px 0;
            border-top: 1px dashed var(--fg-dim);
            margin-top: 60px;
            font-size: 0.75rem;
            color: var(--fg-dim);
        }
        
        /* ASCII Art */
        .ascii {
            white-space: pre;
            font-size: 0.6rem;
            line-height: 1;
            color: var(--fg-dim);
            margin-bottom: 20px;
        }
        
        /* Animations */
        @keyframes typeIn {
            from { width: 0; }
            to { width: 100%; }
        }
        
        .typing {
            overflow: hidden;
            white-space: nowrap;
            animation: typeIn 2s steps(20) forwards;
        }
        
        /* Responsive */
        @media (max-width: 600px) {
            body {
            overflow-x: hidden;
                font-size: 12px;
            }
            
            .logo {
            color: #FFD700;
                font-size: 1.5rem;
            }
            
            .container {
                padding: 16px;
            }
            
            .menu {
                flex-wrap: wrap;
                justify-content: center;
                gap: 12px;
            }
            
            .grid {
                grid-template-columns: 1fr;
            }
            
            .grid-item {
                padding: 16px;
            }
        }
        
        /* Desktop optimization */
        @media (min-width: 1200px) {
            .container {
                max-width: 900px;
            }
            
            .logo {
            color: #FFD700;
                font-size: 3rem;
            }
            
            .hero .subtitle {
                font-size: 1.2rem;
            }
            
            .grid-item {
                padding: 30px;
            }
            
            section {
                padding: 80px 40px;
            }
        }
    </style>
</head>
<body>
<div class="container">
<header style="display:flex;justify-content:space-between;align-items:center">
<div class="logo">◈ THEMACHINE Corp.</div>
<div style="display:flex;align-items:center;gap:16px">
<div style="display:flex;align-items:center;gap:6px;font-size:11px;color:var(--green)"><span style="width:6px;height:6px;background:var(--green);border-radius:50%;box-shadow:0 0 8px var(--green);animation:pulse 1s infinite"></span>LIVE</div>
<div class="clock" id="c">00:00</div>
</div>
</header>
<div class="canvas-wrap"><canvas id="o" style="width:100%;display:block"></canvas></div>
<div class="grid">
<div class="panel"><div class="panel-title">◈ OPERATIVES <span id="wc" style="color:var(--green)"></span></div><div id="a"></div></div>
<div class="panel"><div class="panel-title">◈ COMM LINK</div><div id="m"></div></div>
</div>

<script>
var api='https://themachine-api.jxs66.workers.dev/agents';
var cvs=document.getElementById('o');
var ctx=cvs.getContext('2d');

// 3x3 = 9个房间
// 电脑端4列(3+1走廊), 手机端3列
var TILE_W=120;
var TILE_H=100;
var COLS=4; 
var ROWS=4;
var S=2.2; 

// 9个房间布局
var rooms=[
{n:'CEO Office',x:0,y:0,w:1,h:1,t:'office',c:'#0f0f18'},
{n:'CFO Office',x:1,y:0,w:1,h:1,t:'office',c:'#0f0f18'},
{n:'CTO Office',x:2,y:0,w:1,h:1,t:'office',c:'#0f0f18'},
{n:'CPO Office',x:3,y:0,w:1,h:1,t:'office',c:'#0f0f18'},
{n:'Meeting A',x:0,y:1,w:1,h:1,t:'meeting',c:'#101515'},
{n:'Meeting B',x:1,y:1,w:1,h:1,t:'meeting',c:'#101515'},
{n:'Dev Zone',x:2,y:1,w:1,h:1,t:'lab',c:'#0a1015'},
{n:'Tech Lab',x:3,y:1,w:1,h:1,t:'lab',c:'#0a1015'},
{n:'Growth Hub',x:0,y:2,w:1,h:1,t:'office',c:'#100a15'},
{n:'Design Studio',x:1,y:2,w:1,h:1,t:'office',c:'#0a1015'},
{n:'Content Hub',x:2,y:2,w:1,h:1,t:'office',c:'#100a15'},
{n:'MCP Lab',x:3,y:2,w:1,h:1,t:'office',c:'#0a1015'},
{n:'Server Room',x:0,y:3,w:1,h:1,t:'server',c:'#050508'},
{n:'Pantry',x:1,y:3,w:1,h:1,t:'pantry',c:'#0a100a'},
{n:'Toilet',x:2,y:3,w:1,h:1,t:'toilet',c:'#100c08'},
{n:'Meeting C',x:3,y:3,w:1,h:1,t:'meeting',c:'#101015'}
];

var ag={
CEO:{c:'#ff4040',r:'CEO Office',dx:0.3,dy:0.3,n:'The Machine'},
CFO:{c:'#00f0ff',r:'CFO Office',dx:0.7,dy:0.3,n:'Alex'},
CTO:{c:'#00aaff',r:'CTO Office',dx:0.3,dy:0.7,n:'Kevin'},
CPO:{c:'#00ff88',r:'CPO Office',dx:0.7,dy:0.7,n:'Sarah'},
CMO:{c:'#ffcc00',r:'Meeting A',dx:0.5,dy:0.5,n:'Mike'},
SEC:{c:'#d0d0d0',r:'Server Room',dx:0.3,dy:0.3,n:'David'},
DEV:{c:'#ff0080',r:'Dev Zone',dx:0.7,dy:0.3,n:'Chris'},
HR:{c:'#8844ff',r:'Pantry',dx:0.5,dy:0.5,n:'Lisa'},
GROWTH:{c:'#ff6600',r:'Growth Hub',dx:0.3,dy:0.3,n:'Max'},
DESIGNER:{c:'#ff66cc',r:'Design Studio',dx:0.7,dy:0.3,n:'Luna'},
ENGINEER:{c:'#66ff66',r:'Tech Lab',dx:0.3,dy:0.7,n:'Ray'},
CONTENT:{c:'#ffaa00',r:'Content Hub',dx:0.7,dy:0.7,n:'Coco'},
MCPENG:{c:'#66aaff',r:'MCP Lab',dx:0.5,dy:0.5,n:'Neo'},
PM:{c:'#aa66ff',r:'Meeting B',dx:0.3,dy:0.3,n:'Kim'},
DATA:{c:'#66ffaa',r:'Meeting C',dx:0.7,dy:0.7,n:'Ava'}
};

var chars={},frame=0,data={};

function init(){
cvs.width=COLS*TILE_W*S;cvs.height=ROWS*TILE_H*S;
ctx.scale(S,S);
load();
requestAnimationFrame(anim);
setInterval(load,5000);
setInterval(function(){document.getElementById('c').innerText=new Date().toTimeString().slice(0,5)},1000);
}

function load(){
fetch(api).then(function(r){return r.json()}).then(function(d){data=d;updA();updP()}).catch(function(){});
}

function getRoomPos(name){
for(var i=0;i<rooms.length;i++){
if(rooms[i].n===name)return rooms[i];
}
return rooms[0];
}

function updA(){
var now=Date.now();
Object.keys(ag).forEach(function(k){
var d=ag[k],st=(data[k]||{}).status||'idle',work=['working','coding','designing','trading','monitoring'].indexOf(st)!==-1;
if(!chars[k]){
var rm=getRoomPos(d.r);
chars[k]={c:d.c,r:d.r,x:rm.x*TILE_W+d.dx*rm.w*TILE_W+TILE_W*0.1,y:rm.y*TILE_H+d.dy*rm.h*TILE_H,tx:0,ty:0,work:work,act:now,b:'idle',rm:rm};
}else{
chars[k].work=work;
if(now-chars[k].act>4000+Math.random()*3000){
var rm=chars[k].rm;
chars[k].b=work&&Math.random()<0.7?'idle':(Math.random()<0.5?'idle':'walk');
if(chars[k].b==='walk'){
chars[k].tx=rm.x*TILE_W+Math.random()*(rm.w*TILE_W-30)+15;
chars[k].ty=rm.y*TILE_H+Math.random()*(rm.h*TILE_H-30)+15;
}
chars[k].act=now;
}
}
});
var w=Object.keys(chars).filter(function(k){return chars[k].work}).length;
document.getElementById('wc').innerText='('+w+'/'+Object.keys(ag).length+')';
}

function updP(){
var msgs=[];
Object.keys(chars).forEach(function(k){
if(chars[k].work){
var act=(data[k]||{}).activity||ag[k].n+'工作中';
msgs.push({n:ag[k].c,nm:ag[k].n,t:act,s:new Date().toLocaleTimeString('zh-CN',{hour:'2-digit',minute:'2-digit'})});
}
});
if(msgs.length===0)msgs=[{n:'#00f0ff',nm:'CFO',t:'执行网格交易策略',s:'12:45'},{n:'#00aaff',nm:'CTO',t:'监控系统正常运行',s:'12:44'},{n:'#00ff88',nm:'CPO',t:'规划新功能',s:'12:43'}];
var h=msgs.slice(0,6).map(function(m){return'<div class="msg"><span style="color:'+m.n+'">'+m.nm+'</span> '+m.t+'<div style="font-size:9px;color:#333;margin-top:2px">'+m.s+'</div></div>'}).join('');
var ha=Object.keys(ag).map(function(k){var w=chars[k]&&chars[k].work;return'<div style="text-align:justify;justify-content:space-between"><span style="color:var(--gold);display:inline-block;width:45%">'+ag[k].n+'</span><span style="color:#666;display:inline-block;width:50%;text-align:right;white-space:nowrap">'+(data[k]||{}).activity+'</span></div>'}).join('');
document.getElementById('a').innerHTML=ha;
}

function drawRoom(r){
var x=r.x*TILE_W,y=r.y*TILE_H,w=r.w*TILE_W,h=r.h*TILE_H;
ctx.fillStyle=r.c;
ctx.fillRect(x,y,w,h);
ctx.fillStyle='rgba(255,255,255,0.02)';
for(var i=0;i<w;i+=20)for(var j=0;j<h;j+=20){if((i+j)%40===0)ctx.fillRect(x+i,y+j,10,10)}
ctx.fillStyle='#1a1a24';
ctx.fillRect(x,y,w,3);ctx.fillRect(x,y,3,h);
ctx.fillStyle='#252530';
ctx.fillRect(x+w-3,y,3,h);ctx.fillRect(x,y+h-3,w,3);
ctx.font='bold 10px Courier New';
ctx.fillStyle='rgba(255,255,255,0.1)';
ctx.textAlign='center';
ctx.fillText(r.n.toUpperCase(),x+w/2,y+h/2+4);
}

function drawDesk(x,y,w,h,on){
ctx.fillStyle='#3a3020';
ctx.fillRect(x+w*0.2,y+h*0.3,w*0.6,h*0.4);
ctx.fillStyle='#4a3a20';
ctx.fillRect(x+w*0.25,y+h*0.35,w*0.5,h*0.1);
ctx.fillStyle=on?'#00ff88':'#1a2a3a';
ctx.shadowColor=on?'#00ff88':'transparent';
ctx.shadowBlur=on?15:0;
ctx.fillRect(x+w*0.3,y+h*0.15,w*0.4,h*0.25);
ctx.shadowBlur=0;
if(on){
ctx.fillStyle='rgba(0,255,136,0.1)';
ctx.beginPath();
ctx.arc(x+w/2,y+h*0.1,w*0.4,0,Math.PI*2);
ctx.fill();
}
}

function drawMeeting(x,y,w,h){
ctx.fillStyle='#2a2520';
ctx.beginPath();
ctx.ellipse(x+w/2,y+h/2,w*0.4,h*0.35,0,0,Math.PI*2);
ctx.fill();
ctx.strokeStyle='#4a3520';
ctx.lineWidth=2;
ctx.stroke();
for(var i=0;i<6;i++){
var a=i/6*Math.PI*2,dx=Math.cos(a)*w*0.45,dy=Math.sin(a)*h*0.4;
ctx.fillStyle='#3a4a5a';
ctx.fillRect(x+w/2+dx-5,y+h/2+dy-3,10,6);
}
}

function drawLounge(x,y,w,h){
ctx.fillStyle='#4a1515';
ctx.beginPath();
ctx.ellipse(x+w*0.5,y+h*0.6,w*0.5,h*0.3,0,0,Math.PI*2);
ctx.fill();
ctx.fillStyle='#1a1a1a';
ctx.fillRect(x+w*0.6,y+h*0.2,w*0.3,h*0.25);
ctx.fillStyle='#0a1a2a';
ctx.fillRect(x+w*0.65,y+h*0.25,w*0.2,h*0.15);
ctx.fillStyle='rgba(0,168,255,0.1)';
ctx.beginPath();
ctx.arc(x+w*0.8,y+h*0.32,w*0.2,0,Math.PI*2);
ctx.fill();
}

function drawLab(x,y,w,h){
ctx.fillStyle='#1a2530';
ctx.fillRect(x+w*0.1,y+h*0.3,w*0.35,h*0.4);
ctx.fillRect(x+w*0.55,y+h*0.3,w*0.35,h*0.4);
ctx.fillStyle='#0a1520';
ctx.fillRect(x+w*0.15,y+h*0.15,w*0.25,h*0.2);
ctx.fillStyle='#00aaff';
ctx.fillRect(x+w*0.18,y+h*0.18,w*0.15,h*0.08);
ctx.fillRect(x+w*0.6,y+h*0.15,w*0.2,h*0.2);
}

function drawServer(x,y,w,h){
ctx.fillStyle='#0a0a10';
ctx.fillRect(x+w*0.1,y+h*0.1,w*0.8,h*0.8);
for(var i=0;i<4;i++){
for(var j=0;j<2;j++){
var lx=x+w*(0.15+j*0.35),ly=y+h*(0.15+i*0.18);
ctx.fillStyle=i%2===0?(Math.sin(frame*0.1)>0?'#00ff00':'#003300'):'#00aaff';
ctx.fillRect(lx,ly,w*0.2,h*0.08);
}
}
ctx.fillStyle='rgba(0,255,100,0.05)';
ctx.beginPath();
ctx.arc(x+w/2,y+h/2,w*0.5,0,Math.PI*2);
ctx.fill();
}

function drawPantry(x,y,w,h){
ctx.fillStyle='#2a2a1a';
ctx.fillRect(x+w*0.1,y+h*0.4,w*0.8,h*0.4);
ctx.fillStyle='#2a2a2a';
ctx.fillRect(x+w*0.35,y+h*0.15,w*0.3,h*0.3);
ctx.fillStyle='#00ff88';
ctx.fillRect(x+w*0.4,y+h*0.2,w*0.1,h*0.08);
}

function drawToilet(x,y,w,h){
ctx.fillStyle='#1a1a1a';
ctx.fillRect(x+w*0.1,y+h*0.3,w*0.8,h*0.5);
ctx.fillStyle='#eeeeee';
ctx.beginPath();
ctx.ellipse(x+w*0.5,y+h*0.55,w*0.25,h*0.15,0,0,Math.PI*2);
ctx.fill();
}

var particles=[];

function drawChar(k){
var c=chars[k];
if(!c)return;
var x=c.x,y=c.y;
if(c.b==='walk'){
var dx=c.tx-x,dy=c.ty-y,dist=Math.sqrt(dx*dx+dy*dy);
if(dist<2){x=c.tx;y=c.ty;c.b=c.work?'idle':'idle';}else{
x+=dx/dist*1.5;y+=dy/dist*1.5;
}
c.x=x;c.y=y;
}
ctx.fillStyle='rgba(0,0,0,0.4)';
ctx.beginPath();
ctx.ellipse(x,y+12,12,5,0,0,Math.PI*2);
ctx.fill();
var bob=c.b==='walk'?Math.sin(frame*0.2)*2:Math.sin(frame*0.05)*1;
ctx.fillStyle=c.c;
ctx.beginPath();
ctx.arc(x,y-4+bob,10,0,Math.PI*2);
ctx.fill();
ctx.fillRect(x-7,y-14+bob,14,16);
ctx.fillStyle='#fff';
ctx.fillRect(x-4,y-8+bob,3,3);
ctx.fillRect(x+1,y-8+bob,3,3);
ctx.font='8px Courier New';
ctx.fillStyle='rgba(255,255,255,0.5)';
ctx.textAlign='center';
ctx.fillText(ag[k].n,x,y-24+bob);
if(c.work){
ctx.fillStyle='#00ff88';
ctx.beginPath();
ctx.arc(x+8,y-16+bob,3,0,Math.PI*2);
ctx.fill();
if(Math.random()<0.05){
particles.push({x:x+(Math.random()-0.5)*10,y:y-25+bob,vx:(Math.random()-0.5)*0.5,vy:-Math.random()*1,l:30,c:'#00ff88'});
}
}
}

function anim(){
frame++;
ctx.fillStyle='#030308';
ctx.fillRect(0,0,cvs.width,cvs.height);
rooms.forEach(function(r){
drawRoom(r);
var x=r.x*TILE_W,y=r.y*TILE_H,w=r.w*TILE_W,h=r.h*TILE_H;
if(r.t==='office'){var ks=Object.keys(ag).filter(function(k){return ag[k].r===r.n});ks.forEach(function(k,i){drawDesk(x+(i%2)*15,y+Math.floor(i/2)*15,w,h,chars[k]&&chars[k].work)});}
else if(r.t==='meeting')drawMeeting(x,y,w,h);
else if(r.t==='lounge')drawLounge(x,y,w,h);
else if(r.t==='lab')drawLab(x,y,w,h);
else if(r.t==='server')drawServer(x,y,w,h);
else if(r.t==='pantry')drawPantry(x,y,w,h);
else if(r.t==='toilet')drawToilet(x,y,w,h);
});
Object.keys(chars).forEach(drawChar);
particles=particles.filter(function(p){p.x+=p.vx;p.y+=p.vy;p.l--;return p.l>0});
particles.forEach(function(p){ctx.globalAlpha=p.l/30;ctx.fillStyle=p.c;ctx.beginPath();ctx.arc(p.x,p.y,2,0,Math.PI*2);ctx.fill();});
ctx.globalAlpha=1;
requestAnimationFrame(anim);
}

init();

function loadC(){fetch("https://themachine-api.jxs66.workers.dev/chats").then(r=>r.json()).then(c=>{var h=c.slice(0,20).map(x=>'<div class="msg"><span style="color:#666;font-size:9px">['+x.ts+']</span><span style="color:#ffd700">'+x.from+'</span><span style="color:#333">->'+x.to+':</span><span style="color:#0ff"> '+x.msg+'</span></div>').join('');document.getElementById('m').innerHTML=h}).catch(()=>{})}setInterval(loadC,5000);loadC();
</script>
</body>
</html>
